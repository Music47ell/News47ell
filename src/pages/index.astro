---
import { getCollection } from 'astro:content'
const blog = await getCollection('blog')
import { Image } from 'astro:assets'

import Newsletter from '@/components/Newsletter.astro'
import BaseLayout from '@/layouts/BaseLayout.astro'
import siteMetadata from '@/data/siteMetadata'
import Most from '@/components/Most.astro'
import { getTopPosts } from '@/libs/turso'

const recentPosts = blog
	.sort((a, b) => b.data.published_at.getTime() - a.data.published_at.getTime())
	.slice(0, 3)
const topPosts = await getTopPosts()
---

<BaseLayout
	title={siteMetadata.title}
	description={siteMetadata.description}
	slug="/"
	type="website"
>
	<div class="flex flex-col justify-center gap-y-8">
		<div class="overflow-hidden rounded-xl border border-yellow-500 bg-stone-900">
			<div class="relative border-b border-yellow-500 px-4 py-3">
				<div class="flex items-center gap-x-2">
					<p class="font-bold">Merhaba ðŸ‘‹</p>
				</div>
			</div>
			<div
				class="flex flex-col items-center justify-center gap-x-8 p-4 max-md:gap-y-4 md:flex-row md:justify-between"
			>
				<Image
					src={siteMetadata.author.avatar}
					alt={siteMetadata.author.name}
					height="96"
					width="96"
					class="col-span-1 rounded-md md:order-2"
				/>
				<div class="text-center md:text-left">
					<p>
						{`My name is ${siteMetadata.author.name}. I'm Full Stack Developer from`}
						<span class="font-bold">
							{' '}
							{siteMetadata.author.location.country + ' ' + siteMetadata.author.location.emojiFlag}
						</span>
					</p>
					<p>This site is where I conduct all my experiments, and share my thoughts and ideas.</p>
				</div>
			</div>
		</div>
		<Newsletter />
		<Most title="Most Recent Blog Posts" blog={recentPosts} />
		<Most title="Most Viewed Blog Posts" blog={topPosts} />
	</div>
</BaseLayout>
