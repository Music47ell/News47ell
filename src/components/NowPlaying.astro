---
import MediaCard from '@/components/MediaCard.astro'
---

<MediaCard />

<script lang="ts" type="module">
	const fetchNowPlaying = async () => {
		const res = await fetch('/api/now-playing')
		const data = await res.json()
		return data
	}

	const updateUI = (data) => {
		const url = data.url || ''
		const title = data.title || ''
		const image = data.image || ''
		const isPlaying = data.isPlaying || false

		const urlEl = document.querySelector(`[data-url]`)
		const titleEl = document.querySelector(`[data-title]`)
		const imageEl = document.querySelector(`[data-image]`)

		if (isPlaying) {
			document.querySelector(`[data-card]`).classList.remove('hidden')
		}

		urlEl.href = url
		imageEl.src = image
		imageEl.width = imageEl.height = 100
		titleEl.textContent = imageEl.alt = imageEl.title = title
	}

	const fetchDataAndUpdateUI = async () => {
		try {
			const data = await fetchNowPlaying()
			updateUI(data)
		} catch (error) {
			console.error('Error fetching now playing data:', error)
		}
	}

	// Fetch and update data every 1 minute (60000 milliseconds)
	const updateInterval = 60000
	setInterval(fetchDataAndUpdateUI, updateInterval)

	// Initial fetch and update
	fetchDataAndUpdateUI()
</script>
